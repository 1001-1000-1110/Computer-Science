## 케이블과 리피터, 허브 속을 신호가 흘러간다

> 컴퓨터에서 나온 신호는 케이블을 통해 리피터 허브 등을 경우하여 진행
> 

### 하나하나의 패킷이 독립된 것으로 동작한다

- 패킷은 허브나 라우터라는 중계장치에 의해 중계되어 목적지를 향해 진행
- 패킷의 헤더에 기록된 제어 정보와 중계장치 내부에 있는 표를 통해 목적지를 판단하고, 목적지에 가까워 지도록 하여 패킷을 중계
- 이 교재에서는 클라이언트 PC가 송신한 패킷이 `리피터 허브` `스위칭 허브` `라우터`를 경유하여 인터넷으로 나가는 것으로 간주

### LAN케이블은 신호를 약화시키지 않는 것이 핵심이다

- 전기신호는 케이블을 통해 전달
- 송출된 신호는 허브에 도착할 때는 신호가 약해져 있음
- 약해진 신호는 계속 변형되므로 0과 1을 잘못 판독할 수 있으며, 이는 통신 오류의 원인이 됨

### ‘꼼’은 잡음을 방지하기 위한 방법이다

- LAN 케이블로 사용하는 **트위스트 페어 케이블**을 사용하므로써 신호선을 마주 꼬아서 잡음을 막을 수 있음
- 신호선을 마주 꼬면 잡음의 영향이 줄어들면서 케이블의 성능이 향상
- 추가적으로 신호선 사이의 구분판을 넣거나 금속성의 실드라는 피복을 입히는 등의 대책이 마련되어 있음

### 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다

- 신호가 리피터 허브에 도달하면 이더넷의 기본 원리에 따라 LAN전체에 신호가 흩어진다
    
    이더넷의 기본 원리 : 전체에 패킷의 신호를 뿌리고 수신처 MAC주소에 해당하는 기기만 패킷을 수신
    
- 신호는 모든 커넥터에서 나가면서 리피터 허브에 접속한 전체 기기에 도달
- 신호를 수신한 기기는 MAC헤더에 있는 수신처 MAC주소와 본인의 MAC주소를 비교하여 동일하다면 수신하고 그렇지 않다면 수신한 신호를 무시
- 이 후, 신호는 다음 기기인 스위칭 허브, 라우터, 서버 등에 도달

## 스위칭 허브의 패킷 중계 동작

> 스위칭 허브는 신호를 흘리지 않고 패킷의 신호를 수신하여 디지털 데이터의 형태로 되돌려주고 다시 신호로 고쳐 송신하는 동작을 통해 패킷을 운반
> 

### 스위칭 허브는 주소 테이블로 중계한다

- 신호를 디지털 데이터로 변환하고 패킷의 FCS를 대조하여, 오류가 없다면 버퍼 메모리에 저장
    
    스위칭 허브는 수신처의 MAC주소를 검사하지 않고 모든 패킷을 수신하여 버퍼 메모리에 저장하며 MAC주소가 할당되어있지 않음(↔ LAN 어댑터)
    
- 수신처의 MAC주소와 일치하는 것이 MAC주소표에 등록되어 있는 지 조사
    
    MAC주소표에는 기기의 MAC주소와 그 기기가 어느 포트에 존재하는지에 대한 정보가 등록
    

### MAC주소 테이블을 등록 및 갱신한다

스위칭 허브는 패킷을 중계할 때 MAC주소표의 내용을 갱신하는 동작도 실행

1. 패킷을 수신했을 때 송신처 MAC주소를 조사하고 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC주소표에 등록
2. MAC주소표에 등록한 정보는 일정 시간이 경과되면 삭제
    
    컴퓨터를 들고 이동하면, 스위치 허브 입장에서는 해당 포트의 컴퓨터가 없어져버린것
    

### 예외적인 동작

- 스위칭 허브는 패킷을 수신한 포트와 송신하는 포트가 같을 경우 패킷을 중계하지 않고 폐기
- MAC주소표에 수신처의 MAC주소가 없는 경우 어느 포트에서 송신해야하는 지 판단 할 수 없으므로 패킷을 수신한 이외의 전체 포트에 패킷을 송신
- 브로트캐스트 주소인 경우 수신 포트를 제외하고 모든 포트에서 패팃을 송신
    
    MAC = FF:FF:FF:FF:FF:FF /  IP = 255.255.255.255
    

### 전이중 모드에서 송신과 수신을 동시에 실행한다

전이중 모드 : 송신과 수신을 동시에 실행할 수 있는 성질

- 리피터 허브에 없는 스위칭 허브의 특징
- 수신과 송신이 나뉘어져 있어서 신호가 따로 흐르기 때문에 충돌이 발생하지 않음

### 최적의 전송 속도로 보내는 자동 조정

자동조정 기능

- 접속한 상대가 전이중 모드를 지원하는지 검출하고 동작모드를 자동으로 전환
- 상대의 전송 속도를 검출하여 전송 속도를 자동으로 전환

### 스위칭 허브는 복수의 중계 동작을 동시에 실행한다

스위칭 허브는 수신처 MAC주소의 기기가 존재하는 포트 이외에는 송신 동작을 실행하지 않으므로, 다른 포트는 빈 상태가 됨

→ 빈 포트에는 별도의 패킷을 흘릴 수 있으므로, 동시에 여러개의 패킷을 중계할 수 있음!

## 라우터의 패킷 중계 동작

> 스위칭 허브는 이더넷의 구조를 기초로하여 만든 기기이고 라우터는 IP의 개념을 기초로 하여 만들어진 기기
> 

### 라우터의 기본

라우터는 중계 부분과 포트 부분으로 구성

- 중계부분 : 패킷의 중계 대상을 판단하는 동작
- 포트부분 : 송수신 동작을 담당
1. 포트부분의 하드웨어에 의뢰하여 패킷을 수신
2. 중계부분에서 패킷의 수신처 IP주소와 중계 대상을 등록한 표를 대조하여 중계 대상을 판단
3. 중계 대상의 포트 부분의 하드웨어 규칙에 따라 패킷 송신 동작을 실행

↔ 스위칭 허브는 들어오는 패킷을 전송하기만하고 자신이 송신처나 수신처가 되지 않음


> 💡 라우터의 포트  
> 다양한 통신기술의 하드웨어를 장착하면 다양한 통신 기술을 지원할 수 있다
> ex) ADSL, FTTH, 유선LAN(이더넷), 무선 LAN


### 경로표에 등록된 정보

라우터는 IP헤더에 기재되어 있는 수신처 IP주소로 중계 대상을 판단

라우터의 테이블 = 라우팅 테이블 = 경로표

- 수신처 : 서브넷 자체를 나타내는 주소
    - 네트워크 번호 부분의 비트에만 값이 있고, 호스트 번호 부분의 비트 값을 모두 0으로 되어 있는 IP주소
    - 호스트 번호 부분은 무시하고 네트워크 번호의 부분만 조사
- 넷마스크 : 수신처를 대조할 때 비교 동작을 실행하는 비트수를 나타냄
    
    넷마스크 값을 255.255.255.255로 하여 개별 컴퓨터를 나타낼 수도 있음
    
- 게이트 웨이, 인터페이스 : 패킷의 중계 대상
    
    인터페이스(포트)에 게이트웨이(IP주소)의 라우터에 패킷을 중계
    
- 메트릭 : 수신처 IP주소에 기록되어 있는 목적지가 가까운지 먼지를 나타냄(거리비용)

> 💡 주소 집약  
> 몇 개의 서브넷을 모아서 한 개의 서브넷으로 간주한 후 묶은 서브넷을 경로표에 등록하는 것

### 라우터의 패킷 수신 동작

1. 신호가 라우터의 커넥터 부분에 도착
2. 신호를 디지털 데이터로 변환
3. FCS를 통해 오류의 유무 점검
4. 정상이면 MAC헤더의 수신처 MAC주소가 자신에게 해당하는지 조사
5. 맞다면 수신 버퍼 메모리에 저장

### 경로표를 검색하여 출력 포트를 발견한다

1. 라우터는 패킷의 맨 앞의 MAC헤더를 폐기
2. IP헤더의 내용을 보고 패킷 중계 동작
    - 여러개의 후보가 존재한다면
        1. 네트워크 번호의 비트 수가 가장 긴 것 선택 → 서브넷에 접속 가능한 대수가 적다는 것을 의미
        2. 메트릭 값이 작은 것을 선택
    - 해당하는 행이 하나도 없을 경우
        1. CMP메시지를 송신처에게 통지
        2. 중계 대상이 분명하지 않은 패킷 폐기
            
            ↔ 스위치는 모든 패킷에 뿌림
            

### 해당하는 경로가 없는 경우에 선택하는 기본 경로

넷마스크 항목이 0.0.0.0이면 모든 주소와 일치 → 이 행의 게이트웨이 항목에 인터넷으로 나가는 라우터 등록

= 기본경로 = 기본 게이트웨이

### 패킷은 유효 기한이 있다

송신하기 전, IP헤더의 필드인 TTL을 갱신

(TTL : 패킷의 생존 기간을 나타냄)

라우터를 경유할 때마다 이 값을 1씩 줄이다가 이 숫자가 0이되면 패킷의 생존 기간이 만료된는 것으로 간주

→ 경로표에 등록된 정보에 오류가 있거나 기기의 고장 등으로 패킷이 같은 장소로 뱅글뱅글 순환하는 사태 방지

### 큰 패킷은 조각 나누기 기능으로 분할한다

- 라우터의 포트 부분은 이더넷 이외의 LAN이나 통신회선인 경우가 있음
- 회선이나 LAN종류에 따라 패킷의 최대 길이가 달라짐
- 중계하려는 패킷 > 패킷의 최대 길이 라면 조각 나누기 방법을 사용하여 패킷을 분할하여 중계
- 출력 측의 MTU를 조사하여 분할이 필요할 경우 분할하여 송신

### 라우터의 송신 동작은 컴퓨터와 같다

라우터의 통신 회선의 규칙에 따라 패킷 송신동작 실행

포트가 이더넷인 경우,

1. 경로표의 게이트웨이 항목에서 패킷을 건네줄 상대를 판단
    - 게이트웨이 항목에 IP주소가 있다면 이 IP주소가 건네줄 상대
    - 비어있다면 IP헤더의 수신처 IP주소가 건네줄 상대(라우터없이 직접 건네줌)
2. 상대의 IP주가 결정되면 ARP로 IP주소에서 MAC주소를 조사
3. 결과를 수신처 MAC주소로 설정
4. 출력측의 포트에 할당된 MAC주소를 송신처 MAC주소로 설정
5. 타입필드를 0800로 설정
6. 패킷을 전기신호로 변환하여 포트에서 송신

### 라우터와 스위칭 허브의 관계

IP(PC, 라우터)라는 구조는 스스로 패킷을 운반하는 수단이 없으므로 패킷을 운반할 때는 이더넷(스위칭 허브)에 의뢰하여 운반

- IP가 이더넷에 의뢰하는 것은 최종 목적지까지가 아닌, 다음 라우터에 패킷을 운반하는 것
- 통신상대까지 패킷을 전달하는 전체의 동작은 IP(라우터)가 담당
- 다음 라우터까지 패킷을 운반하는 부분은 이더넷(스위칭 허브)이 담당

## 라우터의 부가 기능

> 라우터는 프라이비트 주소를 글로벌 주소로 변환하는 주소변환 기능과 위험한 패킷을 차단하는 패킷 필터링 기능을 이용
> 

### 주소 변환으로 IP 주소를 효율적으로 이용한다

- 원래의 모든 IP주소는 모두 공개용 이었음 → 네트워크 접속 대수가 늘어나면서, 미래에는 할당할 주소가 없어져버린다는 예측
- 사내용 주소(private address)와 고유한 주소(global address)로 나눔
    
    사내의 기기에 할당하는 주소는 다른 회사와 중복되어도 상관없음
    
- 프라이비트 주소 : 원래의 글로벌 주소 중 범위를 정하고, 사내에서 사용하는 주소라고 약속한 것
    
    10.0.0.0 ~ 10.255.255.255
    
    172.16.0.0 ~ 172.31.255.255
    
    192.168.0.0 ~ 192.168.255.255
    
    → 이 범위는 다른 회사와 중복해도 좋으므로 일원화하여 관리하지 않음. 단, 사내에서의 중복은 피해야함
    
- 단, 사내에서 프라이빗 주소를 할당받은 기기도 인터넷을 통해 외부와 연결되므로, 패킷이 사내와 인터넷을 왕래하면 여기저기에 같은 주소가 있게 되는 문제 발생
    
    → 해결책 : 주소변환
    

### 주소 변환의 기본 동작

패킷을 중계할 때 IP헤더에 기재된 IP주소와 포트번호를 바꿔쓰는 것

최초로 흐르는 패킷을 인터넷에 중계할 경우,

1. 송신처의 IP주소를 프라이비트 주소에서 글로벌 주소로 바꿈
    - 글로벌 주소는 주소변환 장치(라우터, 방화벽 등)의 인터넷 측에 있는 포트에 할당된 주소
    - 포트 번호는 미사용 번호 중 적절히 선택해서 사용
2. 프라이비트 주소와 포트번호 : 글로벌 주소와 포트번호 세트를 대응표에 기록
3. 송신처의  IP주소와 포트 번호를 바꿔쓴 후 패킷을 인터넷에 송출
4. 서버는 회신할 때 바꿔쓴 글로벌 주소와 포트번호로 회신
    
    이 글로벌 주소는 주소변환장치에 할당되어 있으므로, 주소변환장치에 되돌아옴 → 인터넷 측에서 보면 주소변환장치가 통신상대임
    
5. 주소변환 장치는 대응표에서 글로벌 주소와 대응되는 프라이비트 주소를 조사하여, 사내 네트워크에 패킷을 보냄
6. 송신처에 응답 패킷이 도착

그 후 패킷을 주고받을 경우, 대응표를 통해 주소변환하며 통신

1. 송수신이 끝날 경우 대응표에 등록한 것을 삭제

### 포트 번호를 바꿔쓰는 이유

주소만 바꿀 경우, 인터넷에 접속하는 대수만큼 글로벌 주소가 필요

→ 포트번호도 바꿔사용하여 한개의 글로벌 주소를 수만개의 프라이비트 주소에 대응시킬 수 있음

### 인터넷에서 회사로 액세스한다

인터넷에서 사내로 패킷을 중계할 경우 대응표에 등록되어있지 않으므로 중계할 수 없음

- 부정침입 방지하는 효과 굿
- 사전에 대응표에 수동으로 등록한다면 인터넷에서 사내로 패킷 중계 가능

### 라우터의 패킷 필터링 기능

패킷을 중계할 때, MAC헤더, IP헤더, TCP헤더에 기록되어 있는 내용을 조사하여 사전에 설정한 조건에 합치되면 패킷을 중계하고 아니라면 폐기하는 동작 실행

→ 대부분의 방화벽은 이 원리를 이용하여 부정 침입을 방지
