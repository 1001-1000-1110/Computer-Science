### 프로세스 동기화

> **1. 동기화란**
> 
> - 동시다발적으로 실행되는 프로세스들은 공동의 목적을 올바르게 수행하기 위해 서로 협력하며 영향을 주고 받기도 한다.
> - 협력하여 실행되는 프로세스들은 실행 순서와 자원의 일관성을 보장해야 하기 반드시 **동기화** 되어야한다.
> - **프로세스 동기화란 프로세스들 사이의 수행 시기를 맞추는 것을 의미한다.**
>     - 실행 순서 제어 : 프로세스를 올바른 순서대로 실행하기
>     - 상호 배제 : 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기
> - 프로세스 뿐 아니라 스레드도 동기화 대상이다. → **실행의 흐름을 갖는 모든 것은 동기화의 대상이다.**
>     1. **실행 순서 제어를 위한 동기화** 
>         - 동시에 실행되는 프로세스를 올바른 순서대로 실행하는 것이 실행 순서 제어를 위한 프로세스 동기화이다.
>     2. **상호 배제를 위한 동기화** 
>         - 상호 배제는 공유가 불가능한 자원의 동시 사용을 피하기 위해 사용하는 알고리즘이다.
>         - 동시에 접근해서는 안 되는 자원에 동시에 접근하지 못하게 하는 것이 상호 배제를 위한 동기화이다.
> - **공유 자원과 임계 구역**
>     - 공동 자원을 두고 작업하는 자원을 공유 자원이라고 합니다.
>     - 두 개 이상의 프로세스를 동시에 실행하면 문제가 발생하는 자원이 있다.
>     - **동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역**을 **임계 구역**이라고 한다.
>     - 두 개 이상의 프로세스가 임계 구역에 진입하고자 하면 둘 중 하나는 대기해야 한다.
>         - 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우 → **레이스 컨디션**
>     - **레이스 컨디션**이 발생하는 **근본적인 이유**
>         - 고급 언어는 실행 과정에서 저급 언어로 변환되어 실행된다.
>         - 컴퓨터는 고급 언어가 아닌 저급 언어를 실행하기 때문에 여러 줄의 저급 언어로 변환된 고급 언어 한 줄을 실행하는 과정에서 문맥 교환이 일어날 수 있다.
>         - 저급 언어를 실행하는 과정에서 문맥 교환이 일어난다면 아래와 같은 문제가 발생한다.
>     - **임계 구역 문제 해결 원칙**
>         1. 상호 배제 
>             - 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 진입했다면 다른 프로세스는 임계 구역에 들어올 수 없다.
>         2. 진행 
>             - 임계 구역에 어떤 프로세스도 진입하지 않았다면 임계 구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.
>         3. 유한 대기 
>             - 한 프로세스가 임계 구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계 구역에 들어올 수 있어야 한다. → 임계 구역에 들어오기 위해 무한정 대기 X

> **2. 동기화 기법**
> 
> - **뮤텍스 락**
>     - **동시에 접근해서는 안 되는 자원에 동시에 접근하지 않도록 만드는 도구**
>     - 뮤텍스 락의 매우 단순한 형태는 하나의 전역 변수와 두 개의 함수로 구현할 수 있다.
>     - 프로세스는 lock을 획득할 수 없다면, 즉 임계 구역에 진입할 수 없다면 무작정 기다리고,
>     - lock을 획득할 수 있다면, 즉 임계 구역에 진입할 수 있다면 임계 구역을 잠근 뒤 임계 구역에서의 작업을 진행하고, 임계 구역에서 빠져나올 땐 다시 임계 구역의 잠금을 해제함으로써 임계 구역을 보호할 수 있다.
>     - 마치 탈의실 문이 잠겨 있는지 수시로 반복하며 확인해 보는 것과 같다. 이러한 **대기 방식을 바쁜 대기**라고 한다.
> - **세마포**
>     - 세마포는 뮤텍스 락과 비슷하지만, 조금 더 일반화 된 방식의 동기화 도구이다.
>     - 공유 자원이 여러 개 있을 경우 여러 개의 프로세스가 각각 공유 자원에 접근이 가능해야 한다.
>     - **세마포는 공유 자원이 여러 개 있는 상황에서도 적용이 가능한 동기화 도구**이다.
> - **모니터**
>     - 모니터는 공유 자원과 공유 자원에 접근하기 위한 인터페이스를 묶어 관리한다.
>     - 프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근하도록 한다.
>     - 이를 위해 모니터를 통해 공유 자원에 접근하고자 하는 프로세스를 큐에 삽입하고, 큐에 삽입된 순서대로 하나씩 공유 자원을 이용하도록 한다.
>     - 즉 **모니터는 공유 자원을 다루는 인터페이스에 접근하기 위한 큐를 만들고, 모니터 안에 항상 하나의 프로세스만 들어오도록 하여 상호 배제를 위한 동기화를 제공한다.**
>     - 모니터는 세마포와 마찬가지로 실행 순서 제어를 위한 동기화도 제공한다.
>     - **특정 조건을 바탕으로 프로세스를 실행하고 일시 중단하기 위해 모니터는 조건 변수를 사용**하는데, **조건변수는 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수**이다.
>     - 조건 변수로는 wait과 signal 연산을 수행할 수 있다.
>     - wait은 호출한 프로세스의 상태를 대기 상태로 전환하고 일시적으로 조건 변수에 대한 대기 큐에 삽입하는 연산이다.
>     - **모니터에 진입하기 위해 삽입되는 큐와 wait이 호출되어 실행이 중단된 프로세스들이 삽입되는 큐는 다르다.**
>         - 모니터에 진입하기 위해 삽입되는 큐는 한번에 하나의 프로세스만 진입하도록 하기 위해 만들어진 큐
>         - wait이 호출되어 실행이 중단된 프로세스들이 삽입되는 큐는 이미 진입한 프로세스의 실행 조건이 만족될 때까지 잠시 실행이 중단되어 기다리기 위해 만들어진 큐이다.
>     - **모니터는 조건 변수를 이용하여 프로세스 실행 순서 제어를 위한 동기화를 제공한다.**
>         - 특정 프로세스가 아직 실행될 조건이 되지 않았을 때에는 wait을 통해 실행을 중단한다.
>         - 특정 프로세스가 실행될 조건이 충족되었을 때에는 signal을 통해 실행을 재개한다.