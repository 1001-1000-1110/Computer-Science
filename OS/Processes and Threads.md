### 프로세스와 스레드

> **1. 프로세스 개요**
> 
> - **프로세스**
>     - **보조 기억 장치에 저장된 프로그램을 메모리에 적재하고 실행하는 순간 프로그램은 프로세스가 된다.**
>     - 사용자가 볼 수 있는 공간에서 실행되는 프로세스와 보이지 않는 공간에서 실행되는 프로세스가 있다.
>     - **포그라운드 프로세스** / Foreground Process
>         - **사용자가 볼 수 있는** 프로세스, **사용자가 보는 앞에서 실행**되는 프로세스
>     - **백그라운드 프로세스** / Background Process
>         - **사용자가 볼 수 없는** 프로세스, **사용자가 보지 못하는 뒤에서 실행**되는 프로세스
>         - 백그라운드 프로세스에는 사용자와 직접 상호작용하지 않는 프로세스와 사용자와 직접 상호작용하는 프로세스가 있다.
>         - **사용자와 직접 상호작용하지 않는 백그라운드 프로세스**를 유닉스에서는 **데몬,** 윈도우에서는 **서비스**라고 부른다.
> - **프로세스 제어 블록**
>     - 프로세스들은 차례대로 돌아가면서 한정된 시간만큼 CPU를 이용한다.
>         - **타이머 인터럽트**는 클럭 신호를 발생시키는 장치에 의해 주기적으로 발생하는 하드웨어 인터럽트이다.
>     - 운영체제는 빠르게 번갈아 수행되는 프로세스의 실행 순서를 관리하고, 프로세스에 CPU를 비롯한 자원을 배분한다.
>     - 이를 위해 운영체제는 **프로세스 제어 블록**을 이용한다.
>     - **프로세스 제어 블록**에는 해당 **프로세스를 식별하기 위해 꼭 필요한 정보들이 저장**된다.
>     - **PCB**는 **커널 영역에 생성**된다.
>     - **운영체제**도 수많은 프로세스들 사이에서 **PCB로 특정 프로세스를 식별**하고 **해당 프로세스를 처리**하는데 필요한 정보를 판단한다.
>     - PCB는 프로세스 생성 시에 만들어지고 실행이 끝나면 폐기된다.
>     - **PCB에 담기는 정보**
>         1. **프로세스 ID**
>             - **프로세스 ID는 특정 프로세스를 식별하기 위해 부여하는 고유한 번호**이다.
>             - 같은 일을 수행하는 프로그램이라 할지라도 두 번 실행하면 PID가 다른 두 개의 프로세스가 생성된다.
>         2. **레지스터 값**
>             - 프로세스는 자신의 실행 차례가 돌아오면 이전까지 사용했던 **레지스터의 중간값들은 모두 복원**한다.
>             - 이전까지 진행했던 작업들은 그대로 이어 실행할 수 있기 때문이다.
>         3. **CPU 스케줄링 정보**
>             - 프로세스가 언제, 어떤 순서로 CPU를 할당받을지에 대한 정보도 PCB에 기록된다.
>         4. **메모리 관리 정보**
>             - 프로세스마다 메모리에 저장된 위치가 다르다.
>             - 어느 **주소에 저장되어 있는지에 대한 정보**가 있어야 한다.
>         5. **사용한 파일과 입출력장치 목록**
>             - 프로세스가 실행 과정에서 특정 입출력장치나 파일을 사용하면 PCB에 해당 내용이 명시된다.
> - **문맥 교환**
>     - **중간 정보, 즉 하나의 프로세스 수행을 재개하기 위해 기억해야할 정보를 문맥**이라고 한다.
>     - 하나의 프로세스 문맥은 해당 프로세스의 PCB에 표현되어 있다.
>     - 실행 문맥을 잘 기억해두면 언제든 해당 프로세스의 실행을 재개할 수 있기 때문에 프로세스가 CPU를 사용할 수 있는 시간이 다 되거나 예기치 못한 상황이 발생하면 운영체제는 해당 프로세스의 PCB에 문맥을 백업한다.
>     - **기존 프로세스의 문맥을 PCB에 백업하고, 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 복구하여 새로운 프로세스를 실행하는 것을 문맥 교환**이라고 한다.
>         - **문맥 교환을 너무 자주하면 오버헤드가 발생**할 수 있기 때문에 문맥 교환이 자주 일어나는 것이 좋은 것은 아니다.
> - 프로세스의 **메모리 영역**
>     - **코드 영역**
>         - 코드영역은 **텍스트 영역**이라고도 불린다.
>         - 실행할 수 있는 코드, 즉 기계어로 이루어진 명령어가 저장된다.
>         - **읽기 전용 공간**이다.
>     - **데이터 영역**
>         - **데이터 영역은 잠깐 썼다가 없앨 데이터가 아닌 프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간**이다.
>         - 데이터로는 **전역 변수**가 대표적이다.
>     - **힙 영역**
>         - 힙 영역은 프로그램을 만드는 사용자, 즉 프로그래머가 **직접 할당할 수 있는 저장공간**이다.
>         - **메모리 공간을 반환하지 않는다면 할당한 공간은 메모리 내에 계속 남아 메모리 낭비를 초래**한다.
>         - 이러한 문제를 **메모리 누수**라고 한다.
>     - **스택 영역**
>         - **스택 영역은 데이터를 일시적으로 저장하는 공간**이다.
>         - 매개 변수, 지역 변수, 일시적으로 사용할 데이터
>         - **힙 영역과 스택 영역은 실시간으로 그 크기가 변할 수 있기 때문에** **동적 할당 영역**이라고 부른다.
>         - **힙 영역은 메모리의 낮은 주소에서 높은 주소로 할당**되고, **스택 영역은 높은 주소에서 낮은 주소로 할당**된다.

> **2. 프로세스 상태와 계층 구조**
> 
> - 운영체제는 이처럼 동시에 실행되는 수많은 **프로세스를 계층적으로 관리**한다.
> - **프로세스 상태**
>     - **운영체제**는 **프로세스의 상태를 PCB를 통해 인식하고 관리**한다.
>     - **생성 상태** / New
>         - **프로세스를 생성 중인 상태를 생성 상태**
>         - 메모리에 적재되어 **PCB를 할당 받은 상태**를 말한다.
>     - **준비 상태** / Ready
>         - 생성 상태를 거쳐 실행할 **준비가 완료된 프로세스는 곧바로 실행되지 않고 준비 상태**가 되어 **CPU의 할당을 기다린다.**
>         - 준비 상태는 당장이라도 CPU를 할당받아 실행할 수 있지만, 기다리고 있는 상태이다.
>     - **실행 상태** / Running
>         - 실행 상태는 **CPU를 할당 받아 실행 중인 실행 중인 상태**를 의미한다.
>         - 실행 상태인 프로세스는 **할당된 일정 시간 동안만 CPU를 사용할 수 있다.**
>     - **대기 상태**  / Blocked
>         - 입출력 작업을 요청한 프로세스는 입출력장치가 입출력을 끝낼 때까지 기다려야한다.
>         - **입출력장치의 작업을 기다리는 상태**를 대기 상태라고 한다.
>         - **특정 이벤트가 일어나길 기다릴 때 프로세스는 대기 상태**가 된다.
>         - 대기 상태가 되는 대부분의 원인이 입출력 작업이기 때문에 프로세스가 입출력 작업을 하면 대기상태가 된다고 생각해도 된다.
>     - **종료 상태** / Terminated
>         - **프로세스가 종료된 상태**
> - **프로세스 상태 다이어그램**
>     <img src = 'image/Process Status Diagram.jpg' alt = 'Process Status Diagram' width='500' height='5g00'>
> - **프로세스 계층 구조**
>     - 프로세스는 **실행 도중 시스템 호출을 통해 다른 프로세스를 생성할 수 있다.**
>     - **생성한 프로세스를 부모 프로세스, 생성된 프로세스를 자식 프로세스**라고 한다.
>     - 다른 프로세스이기에 **각기 다른 PID를 가진다.**
>     - 최초의 프로세스 PID는 항상 1번이며, 모든 프로세스 최상단에 있는 부모 프로세스이다.
>         - pstree 명령어는 프로세스 계층 구조를 보여주는 명령어이다.
> - **프로세스 생성 기법**
>     - **부모 프로세스는 fork를 통해 자신의 복사본을 자식 프로세스로 생성**하고, **만들어진 복사본(자식 프로세스)는 exec를 통해 자신의 메모리 공간을 다른 프로그램으로 교체**한다.
>     - **fork와 exec는 시스템 호출**이다.
>     - **fork**는 **자기 자신 프로세스의 복사본을 만드는 시스템 호출**이다.
>     - 복사된 자식 프로세스라 할지라도 PID 값이나 저장된 메모리 위치는 다르다.
>     - **자식 프로세스는 exec 시스템 호출을 통해 새로운 프로그램으로 전환**된다.
>     - **exec**는 **자신의 메모리 공간을 새로운 프로그램으로 덮어쓰는 프로그램 호출**이다.
>     - 새로운 프로그램 내용으로 전환하여 실행하는 시스템 호출이다.
>     - **exec를 호출**하면 **코드 영역과 데이터 영역의 내용이 실행할 프로그램의 내용으로 바뀌고, 나머지 영역은 초기화** 된다.
>     - 부모가 자식 프로세스를 실행하며 프로세스 **계층 구조를 이루는 과정**은 **fork와 exec가 반복되는 과정**이다.
>     - **exec를 호출하지 않는 경우**
>         - 부모 프로세스와 자식 프로세스는 **같은 코드를 병향하여 실행하는 프로세스**가 된다.

> **3. 스레드**
> 
> - **스레드는 실행의 단위**이다.
> - 스레드란 **프로세스를 구성하는 실행의 흐름 단위**이다.
> - 하나의 프로세스는 여러 개의 스레드를 가질 수 있다.
> - **프로세스와 스레드**
>     - 실행의 흐름 단위가 하나라는 점에서 이렇게 실행되는 프로세스들은 **단일 스레드 프로세스**이다.
>     - 스레드라는 개념이 도입되면서 하나의 프로세스가 한 번에 여러 일을 동시에 처리할 수 있게 되었다.
>     - 스레드는 프로세스 내에서 각각 다른 **스레드 ID, 프로세스 카운터 값을 비롯한 레지스터 값, 스택으로 구성**된다.
>     - 프로세스의 스레드들은 **실행에 필요한 최소한의 정보만을 유지**한 채 **프로세스 자원을 공유하며 실행된다**는 점이다.
>     - 프로세스와 스레드 간에 명확한 구분을 짓지 않는 운영체제
>         - 리눅스, 모두 **실행의 문맥이라는 점에서 동등하다고 간주**한다.
>         - 프로세스와 스레드라는 말 대신 **태스크**라는 이름으로 통일하여 명명한다.
> - **멀티 프로세스와 멀티 스레드**
>     - **여러 프로세스를 동시에 실행하는 것**을 **멀티 프로세스,** **여러 스레드로 프로세스를 동시에 실행하는 것**을 **멀티 스레드**라고 한다.
>     - 프로세스끼리는 기본적으로 자원을 공유하지 않지만 , 스레드끼리는 같은 프로세스 자원을 공유한다.
>     - 주소를 제외하면 모든 것이 동일한 프로세스 두 개가 통째로 메모리에 적재된다.
>     - **쓰기 시 복사 기법** / copy on write
>         - fork를 한 직후 같은 프로세스를 통째로 메모리에 **중복 저장하지 않으면서 동시에 프로세스끼리 지원을 공유하지 않는 방법**이다.
>     - **같은 프로세스 내의 모든 스레드**는 **동일한 주소 공간의 코드, 데이터, 힙 영역을 공유**하고 **열린 파일과 같은 프로세스 자원을 공유**한다.
>     - 여러 프로세스를 병행 실행하는 것보다 메모리를 더 효율적으로 사용할 수 있다.
>     - 멀티 스레드 환경에서 하나의 스레드에 문제가 생기면 프로세스 전체에 문제가 생길 수 있다.
>     - **프로세스 간 통신**
>         - 프로세스끼리는 기본적으로 자원을 공유하지 않지만, 프로세스끼리도 자원을 공유하고 데이터를 주고 받을 수 있다.
>         - **프로세스 간의 자원을 공유하고 데이터를 주고 받는 것**을 **프로세스 간 통신(Inter Process Communication)** 이라고 한다.
>         - **파일을 통한 프로세스 간 통신**
>         - **프로세스들이 공유할 수 있는 메모리 영역**을 **공유 메모리**라고 한다.