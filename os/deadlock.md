## 교착상태란

두 개 이상의 프로세스가 각자 가지고 있는 자원을 서로 무작정 기다린다면 그 어떤 프로세스도 더 이상 진행할 수 없는 상태

### 식사하는 철학자 문제

1. 생각하다가 왼쪽 포크가 사용 가능하면 집어든다.
2. 생각하다가 오른쪽 포크가 사용 가능하면 집어든다.
3. 왼쪽과 오른쪽 포크를 모두 집어들면 정해진 시간동안 식사를 한다.
4. 식사 시간이 끝나면 오른쪽 포크를 내려놓는다.
5. 왼쪽 포크를 내려놓는다.
6. 1번부터 반복한다.

→ 모든 철학자가 왼쪽 포크를 집어들면 모두가 오른쪽 포크를 집어들 수 없고 어떤 철학자로 식사를 할 수 없는 **교착상태** 발생

- 철학자 : 프로세스 혹은 스레드
- 포크 : 자원(임계구역)
- 생각 : 자원을 기다리는 것

### 뮤텍스 락의 교착상태

```java
lock1 = true;
while (lock2 == true)
	;
// 임계구역 진입
lock1 = false;
```

```java
lock2 = true;
while (lock1 == true)
	;
// 임계구역 진입
lock2 = false;
```

### 자원 할당 그래프

어떤 프로세스가 어떤 자원을 사용하고있고, 또 어떤 프로세스가 어떤 자원을 기다리고 있는지를 표현하는 간단한 그래프

- A는 SSD를 사용 중
- B,C는 CPU를 사용 중
- F는 CPU할당을 기다리는 중
- D는 프린터를 사용 중
- E는 프린터 할당을 기다리는 중

### 교착 상태 발생 조건

아래 4개의 조건 중 하나라도 만족하지 않는다면 교착상태가 발생하지 않는다. 아래 조건이 모두 만족되면 **교착 상태가 발생할 가능성**이 생긴다.

1. 상호배제
    
    한 프로세스가 사용하는 자원을 다른 프로세스가 사용할 수 없다
    
2. 점유와 대기
    
    자원을 할당받은 상태에서 다른 자원을 할당 받기를 기다리는 상태
    
3. 비선점
    
    어떤 프로세스도 다른 프로세스의 자원을 강제로 빼앗지 못하는 상태
    
4. 원형 대기
    
    프로세스들이 원의 형태로 자원을 대기하는 것
    

## 교착 상태 해결 방법

교착상태를 해결하는 방법에는 예방, 회피, 검출 후 회복이 있다.

1. 예방
    
    교착상태가 발생하지 않도록 발생 조건에 부합하지 않게 자원을 분배
    
    → 교착상태 네가지 조건중 하나를 충족하지 못하게하는 방법
    
    - 상호배제
        
        모든 자원을 공유 가능하도록 만든다
        
        < 단점 >
        
        1. 현실적으로 불가능
    - 점유와 대기
        
        특정 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않는다
        
        < 단점 >
        
        1. 자원의 활용률이 낮아진다.
            
            당장 자원이 필요해도 기다릴수 밖에 없는 프로세스와 당장 사용되지 않으면서 미리 선점되어 있는 자원 낭비
            
        2. 많은 종류의 자원을 사용하는 프로세스가 불리해진다.
            
            동시에 여러 자원을 사용할 타이밍을 확보하기가 어려워, 무한정 기다리게 되는 기아현상을 야기
            
    - 비선점
        
        자원을 이용 중인 프로세스로부터 해당 자원을 빼앗는다. CPU 등 선점 가능한 자원에 대해 효과적이다.
        
        < 단점 >
        
        1. 선점 불가능한 자원도 존재하기 때문에 범용성이 떨어진다.
    - 원형대기
        
        모든 자원에 번호를 붙이고, 오름차순으로 자원을 할당하여 자원을 한 방향으로만 사용
        
        철학자들로 하여금 번호가 낮은 포크에서 높은 포크 순으로 집어들게 한다면, 5번포크를 집어들고 1번 포크를 집어들 수 없기 때문에 원형 대기가 발생하지 않는다.
        
        < 단점 >
        
        1. 컴퓨터 내에 존재하는 수많은 자원에 번호를 붙이는 일은 간단한 작업이 아니다.
        2. 각 자원에 어떤 번호를 붙이는 지에 따라 특정 자원의 활용률이 떨어진다.
            
            오름차순이기 때문에 낮은 번호의 활용률이 떨어질 수도 있다.
            
        
2. 회피
    
    교착상태가 발생하지 않을 정도로 자원을 할당하다가 교착상태의 위험이 있다면 자원을 할당하지 않는 방식
    
    → 교착 상태를 한정된 자원의 무분별한 할당으로 인해 발생하는 문제로 간주
    
    - 안전 순서열 : 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서를 의미
    - 안전상태 : 안전 순서열대로 프로세스들에 자원을 배분하여 교착상태가 발생하지 않는 상태
    - 불안전상태 : 안전 순서열이 없어 교착 상태가 발생할 가능성이 있는 상태
3. 검출 후 회복
    
    자원을 제약 없이 할당하다가 교착상태가 검출되면 교착 상태를 회복하는 방식
    
    → 교착 상태 발생 여부를 주기적으로 검사하며 교착상태가 발생하였다면 사후에 조치하는 방식
    
    1. 선점을 통한 회복
        
        교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
        
    2. 프로세스 강제 종료를 통한 회복
        - 프로세스를 모두 강제 종료
            
            프로세스들의 작업 내역을 잃게될 가능성
            
        - 교착상태가 없어질 때까지 한 프로세스씩 강제 종료
            
            작업 내역을 잃는 프로세스를 최대한 줄일 수 있지만, 반복적인 교착상태 발생 여부 확인에 대한 오버헤드 야기
            

> **타조 알고리즘**
> 
> 
> 드물게 발생하는 잠재적 문제를 무시로 대처하는 방식
>
