# 입출력장치
## 장치 컨트롤러와 장치 드라이버
- - -
### 장치 컨트롤러( = 입출력제어기(I/O controller) = 입출력 모듈(I/O module))
- 장치컨트롤러를 사용하는 이유
  - 입출력장치의 종류가 너무 많음
  - cpu, 메모리의 데이터 전송률과 입출력장치의 데이터 전송률의 차이
    - *전송률(transfer rate) : 데이터를 얼마나 빨리 교환할 수 있는지를 나타내는 지표 

- 장치 컨트롤러의 역할
  - cpu와 입출력장치 간의 통신 중개
  - 오류 검출
  - 데이터 버퍼링
    - *버퍼링(buffering) : 전송률이 높은 장치와 낮은 장치 사이에서 주고받는 데이터를 `버퍼(buffer)`라는 임시 공간에 저장하여 전송률을 비슷하게 맞추는 방법.

- 장치 컨트롤러의 내부구조
  - 데이터레지스터 : cpu와 입출력장치 사이에 주고받을 데이터가 담기는 레지스터(`buffer`역할)
  - 상태레지스터 : 입출력장치가 작업할 준비가 되었는 지, 작업이 완료되었는지, 오류가 없는지 등 상태가 저장되는 레지스터
  - 제어레지스터 : 입출력장치가 수행할 제어 정보와 명령이 저장되는 레지스터

### 장치 드라이버
장치드라이버(device driver)란 장치컨트롤러의 동작을 감지하고 제어함으로써 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 `프로그램`
- 장치드라이버를 인식하고 실행하는 주체는 `운영체제`

## 다양한 입출력 방법
- - -
cpu와 장치컨트롤러가 정보를 주고받는 방법
1. 프로그램입출력 
2. 인터럽트 기반 입출력 
3. DMA입출력

### 프로그램입출력
프로그램입출력(programmed I/O)는 프로그램속 명령어로 입출력장치는 제어하는 방식입니다.
cpu가 입출력 명령어를 만나면 cpu는 입출력장치에 연결된 장치 컨트롤러와 상호작용하며 입출력 작업을 수행합니다.

- 매모리 맵 입출력
  - 메모리에 접근하기 위한 주소공간과 입출력장치에 접근하기 위한 주소공간을 하나의 주소공간으로 간주하는 방법
  - 메모리 주소 공간이 축소됨
  - cpu가 메모리와 입출력장치에 접근하는 명령어가 동일함.
- 고립형 입출력
  - 메모리를 위한 주소공간과 입출력장치를 위한 주소공간을 분리하는 방법
  - 메모리 주소공간이 축소되지 않음
  - 입출력전용 명령어가 필요함.

### 인터럽트 기반 입출력
cpu는 장치 컨트롤러에 입출력 작업을 명령하고, 장치컨트롤러가 입출력장치를 제어하기 때문에 이 시간동안 cpu는 다른 작업을 할수 있습니다.
입출력 작업이 종료되면, 장치컨트롤러는 cpu에게 인터럽트 요청신호를 보냅니다. cpu는 하는 일을 잠시 백업하고 인터럽트 서비스 루틴을 실행합니다.
- *폴링: cpu가 주기적으로 입출력장치의(상태레지터) 상태가 어떤지, 처리할 데이터가 있는지 확인하는 방식으로, cpu의 부담이 인터럽트 방식보다 큽니다.

- 프로그래머블 인터럽트 컨트롤러(PIC: Programmable Interupt Controller)
  - 우선순위를 반영한 다중인터럽트를 처리하기 위한 하드웨어로 cpu와 장치컨트롤러 중간에서 사용된다.
  - NMI(Non Maskable Interrupt)까지 우선순위를 판별하지 않는다. 우선순위가 가장 높아 판별이 불필요하기 때문
  
### DMA 입출력
DMA(Direct Memory Access) : 시스템버스에 연결된 DMA컨트롤러를 활용하여, 입출력장치와 메모리가 cpu를 거치지않고 상호작용할 수 있는 입출력 방식
- DMA 입출력 과정
  1. cpu는 DMA컨트롤러에 입출력장치의 주소, 수행할 연산, 읽거나 쓸 메모리의 주소 등 입출력작업을 명령합니다
  2. DMA컨트롤러는 cpu대신 장치컨트롤러와 상호작용하며 입출력작업을 수행합니다.
  3. 입출력 작업이 끝나면 DMA컨트롤러는 cpu에 인터럽트 신호를 보냅니다.

위 과정에서 시스템버스를 통해 메모리에 직접접근합니다. 즉, cpu와 DMA컨트롤러가 시스템 버스를 번갈아가면서 사용해야합니다. 따라서 DMA의 시스템버스 이용을
`사이클 스틸링`이라고 부르기도 합니다.
- 입출력버스
  - `사이클 스틸링`문제를 해소하기 위한 버스
  - `DMA컨트롤러`와 `장치컨트롤러`를 연결하여 `시스템버스`의 사용빈도를 줄인다.